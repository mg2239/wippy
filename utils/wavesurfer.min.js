(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define("WaveSurfer",[],factory);else if(typeof exports==="object")exports["WaveSurfer"]=factory();else root["WaveSurfer"]=factory()})(window,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function(module,exports){function debounce(func,wait,immediate){var timeout,args,context,timestamp,result;if(null==wait)wait=100;function later(){var last=Date.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}}var debounced=function(){context=this;args=arguments;timestamp=Date.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result};debounced.clear=function(){if(timeout){clearTimeout(timeout);timeout=null}};debounced.flush=function(){if(timeout){result=func.apply(context,args);context=args=null;clearTimeout(timeout);timeout=null}};return debounced}debounce.debounce=debounce;module.exports=debounce},"./src/drawer.canvasentry.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _style=_interopRequireDefault(__webpack_require__("./src/util/style.js"));var _getId=_interopRequireDefault(__webpack_require__("./src/util/get-id.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var CanvasEntry=function(){function CanvasEntry(){_classCallCheck(this,CanvasEntry);this.wave=null;this.waveCtx=null;this.progress=null;this.progressCtx=null;this.start=0;this.end=1;this.id=(0,_getId.default)(typeof this.constructor.name!=="undefined"?this.constructor.name.toLowerCase()+"_":"canvasentry_");this.canvasContextAttributes={}}_createClass(CanvasEntry,[{key:"initWave",value:function initWave(element){this.wave=element;this.waveCtx=this.wave.getContext("2d",this.canvasContextAttributes)}},{key:"initProgress",value:function initProgress(element){this.progress=element;this.progressCtx=this.progress.getContext("2d",this.canvasContextAttributes)}},{key:"updateDimensions",value:function updateDimensions(elementWidth,totalWidth,width,height){this.start=this.wave.offsetLeft/totalWidth||0;this.end=this.start+elementWidth/totalWidth;this.wave.width=width;this.wave.height=height;var elementSize={width:elementWidth+"px"};(0,_style.default)(this.wave,elementSize);if(this.hasProgressCanvas){this.progress.width=width;this.progress.height=height;(0,_style.default)(this.progress,elementSize)}}},{key:"clearWave",value:function clearWave(){this.waveCtx.clearRect(0,0,this.waveCtx.canvas.width,this.waveCtx.canvas.height);if(this.hasProgressCanvas){this.progressCtx.clearRect(0,0,this.progressCtx.canvas.width,this.progressCtx.canvas.height)}}},{key:"setFillStyles",value:function setFillStyles(waveColor,progressColor){this.waveCtx.fillStyle=waveColor;if(this.hasProgressCanvas){this.progressCtx.fillStyle=progressColor}}},{key:"fillRects",value:function fillRects(x,y,width,height,radius){this.fillRectToContext(this.waveCtx,x,y,width,height,radius);if(this.hasProgressCanvas){this.fillRectToContext(this.progressCtx,x,y,width,height,radius)}}},{key:"fillRectToContext",value:function fillRectToContext(ctx,x,y,width,height,radius){if(!ctx){return}if(radius){this.drawRoundedRect(ctx,x,y,width,height,radius)}else{ctx.fillRect(x,y,width,height)}}},{key:"drawRoundedRect",value:function drawRoundedRect(ctx,x,y,width,height,radius){if(height===0){return}if(height<0){height*=-1;y-=height}ctx.beginPath();ctx.moveTo(x+radius,y);ctx.lineTo(x+width-radius,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius);ctx.lineTo(x+width,y+height-radius);ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);ctx.lineTo(x+radius,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius);ctx.lineTo(x,y+radius);ctx.quadraticCurveTo(x,y,x+radius,y);ctx.closePath();ctx.fill()}},{key:"drawLines",value:function drawLines(peaks,absmax,halfH,offsetY,start,end){this.drawLineToContext(this.waveCtx,peaks,absmax,halfH,offsetY,start,end);if(this.hasProgressCanvas){this.drawLineToContext(this.progressCtx,peaks,absmax,halfH,offsetY,start,end)}}},{key:"drawLineToContext",value:function drawLineToContext(ctx,peaks,absmax,halfH,offsetY,start,end){if(!ctx){return}var length=peaks.length/2;var first=Math.round(length*this.start);var last=Math.round(length*this.end)+1;var canvasStart=first;var canvasEnd=last;var scale=this.wave.width/(canvasEnd-canvasStart-1);var halfOffset=halfH+offsetY;var absmaxHalf=absmax/halfH;ctx.beginPath();ctx.moveTo((canvasStart-first)*scale,halfOffset);ctx.lineTo((canvasStart-first)*scale,halfOffset-Math.round((peaks[2*canvasStart]||0)/absmaxHalf));var i,peak,h;for(i=canvasStart;i<canvasEnd;i++){peak=peaks[2*i]||0;h=Math.round(peak/absmaxHalf);ctx.lineTo((i-first)*scale+this.halfPixel,halfOffset-h)}var j=canvasEnd-1;for(j;j>=canvasStart;j--){peak=peaks[2*j+1]||0;h=Math.round(peak/absmaxHalf);ctx.lineTo((j-first)*scale+this.halfPixel,halfOffset-h)}ctx.lineTo((canvasStart-first)*scale,halfOffset-Math.round((peaks[2*canvasStart+1]||0)/absmaxHalf));ctx.closePath();ctx.fill()}},{key:"destroy",value:function destroy(){this.waveCtx=null;this.wave=null;this.progressCtx=null;this.progress=null}},{key:"getImage",value:function getImage(format,quality,type){var _this=this;if(type==="blob"){return new Promise(function(resolve){_this.wave.toBlob(resolve,format,quality)})}else if(type==="dataURL"){return this.wave.toDataURL(format,quality)}}}]);return CanvasEntry}();exports.default=CanvasEntry;module.exports=exports.default},"./src/drawer.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var util=_interopRequireWildcard(__webpack_require__("./src/util/index.js"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Drawer=function(_util$Observer){_inherits(Drawer,_util$Observer);function Drawer(container,params){var _this;_classCallCheck(this,Drawer);_this=_possibleConstructorReturn(this,_getPrototypeOf(Drawer).call(this));_this.container=container;_this.params=params;_this.width=0;_this.height=params.height*_this.params.pixelRatio;_this.lastPos=0;_this.wrapper=null;return _this}_createClass(Drawer,[{key:"style",value:function style(el,styles){return util.style(el,styles)}},{key:"createWrapper",value:function createWrapper(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"})}this.setupWrapperEvents()}},{key:"handleEvent",value:function handleEvent(e,noPrevent){!noPrevent&&e.preventDefault();var clientX=e.targetTouches?e.targetTouches[0].clientX:e.clientX;var bbox=this.wrapper.getBoundingClientRect();var nominalWidth=this.width;var parentWidth=this.getWidth();var progress;if(!this.params.fillParent&&nominalWidth<parentWidth){progress=(this.params.rtl?bbox.right-clientX:clientX-bbox.left)*(this.params.pixelRatio/nominalWidth)||0;if(progress>1){progress=1}}else{progress=((this.params.rtl?bbox.right-clientX:clientX-bbox.left)+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0}return progress}},{key:"setupWrapperEvents",value:function setupWrapperEvents(){var _this2=this;this.wrapper.addEventListener("click",function(e){var scrollbarHeight=_this2.wrapper.offsetHeight-_this2.wrapper.clientHeight;if(scrollbarHeight!==0){var bbox=_this2.wrapper.getBoundingClientRect();if(e.clientY>=bbox.bottom-scrollbarHeight){return}}if(_this2.params.interact){_this2.fireEvent("click",e,_this2.handleEvent(e))}});this.wrapper.addEventListener("dblclick",function(e){if(_this2.params.interact){_this2.fireEvent("dblclick",e,_this2.handleEvent(e))}});this.wrapper.addEventListener("scroll",function(e){return _this2.fireEvent("scroll",e)})}},{key:"drawPeaks",value:function drawPeaks(peaks,length,start,end){if(!this.setWidth(length)){this.clearWave()}this.params.barWidth?this.drawBars(peaks,0,start,end):this.drawWave(peaks,0,start,end)}},{key:"resetScroll",value:function resetScroll(){if(this.wrapper!==null){this.wrapper.scrollLeft=0}}},{key:"recenter",value:function recenter(percent){var position=this.wrapper.scrollWidth*percent;this.recenterOnPosition(position,true)}},{key:"recenterOnPosition",value:function recenterOnPosition(position,immediate){var scrollLeft=this.wrapper.scrollLeft;var half=~~(this.wrapper.clientWidth/2);var maxScroll=this.wrapper.scrollWidth-this.wrapper.clientWidth;var target=position-half;var offset=target-scrollLeft;if(maxScroll==0){return}if(!immediate&&-half<=offset&&offset<half){var rate=this.params.autoCenterRate;rate/=half;rate*=maxScroll;offset=Math.max(-rate,Math.min(rate,offset));target=scrollLeft+offset}target=Math.max(0,Math.min(maxScroll,target));if(target!=scrollLeft){this.wrapper.scrollLeft=target}}},{key:"getScrollX",value:function getScrollX(){var x=0;if(this.wrapper){var pixelRatio=this.params.pixelRatio;x=Math.round(this.wrapper.scrollLeft*pixelRatio);if(this.params.scrollParent){var maxScroll=~~(this.wrapper.scrollWidth*pixelRatio-this.getWidth());x=Math.min(maxScroll,Math.max(0,x))}}return x}},{key:"getWidth",value:function getWidth(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function setWidth(width){if(this.width==width){return false}this.width=width;if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:""})}else{this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"})}this.updateSize();return true}},{key:"setHeight",value:function setHeight(height){if(height==this.height){return false}this.height=height;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize();return true}},{key:"progress",value:function progress(_progress){var minPxDelta=1/this.params.pixelRatio;var pos=Math.round(_progress*this.width)*minPxDelta;if(pos<this.lastPos||pos-this.lastPos>=minPxDelta){this.lastPos=pos;if(this.params.scrollParent&&this.params.autoCenter){var newPos=~~(this.wrapper.scrollWidth*_progress);this.recenterOnPosition(newPos,this.params.autoCenterImmediately)}this.updateProgress(pos)}}},{key:"destroy",value:function destroy(){this.unAll();if(this.wrapper){if(this.wrapper.parentNode==this.container){this.container.removeChild(this.wrapper)}this.wrapper=null}}},{key:"updateCursor",value:function updateCursor(){}},{key:"updateSize",value:function updateSize(){}},{key:"drawBars",value:function drawBars(peaks,channelIndex,start,end){}},{key:"drawWave",value:function drawWave(peaks,channelIndex,start,end){}},{key:"clearWave",value:function clearWave(){}},{key:"updateProgress",value:function updateProgress(position){}}]);return Drawer}(util.Observer);exports.default=Drawer;module.exports=exports.default},"./src/drawer.multicanvas.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _drawer=_interopRequireDefault(__webpack_require__("./src/drawer.js"));var util=_interopRequireWildcard(__webpack_require__("./src/util/index.js"));var _drawer2=_interopRequireDefault(__webpack_require__("./src/drawer.canvasentry.js"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var MultiCanvas=function(_Drawer){_inherits(MultiCanvas,_Drawer);function MultiCanvas(container,params){var _this;_classCallCheck(this,MultiCanvas);_this=_possibleConstructorReturn(this,_getPrototypeOf(MultiCanvas).call(this,container,params));_this.maxCanvasWidth=params.maxCanvasWidth;_this.maxCanvasElementWidth=Math.round(params.maxCanvasWidth/params.pixelRatio);_this.hasProgressCanvas=params.waveColor!=params.progressColor;_this.halfPixel=.5/params.pixelRatio;_this.canvases=[];_this.progressWave=null;_this.EntryClass=_drawer2.default;_this.canvasContextAttributes=params.drawingContextAttributes;_this.overlap=2*Math.ceil(params.pixelRatio/2);_this.barRadius=params.barRadius||0;return _this}_createClass(MultiCanvas,[{key:"init",value:function init(){this.createWrapper();this.createElements()}},{key:"createElements",value:function createElements(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}));this.addCanvas();this.updateCursor()}},{key:"updateCursor",value:function updateCursor(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function updateSize(){var _this2=this;var totalWidth=Math.round(this.width/this.params.pixelRatio);var requiredCanvases=Math.ceil(totalWidth/(this.maxCanvasElementWidth+this.overlap));while(this.canvases.length<requiredCanvases){this.addCanvas()}while(this.canvases.length>requiredCanvases){this.removeCanvas()}var canvasWidth=this.maxCanvasWidth+this.overlap;var lastCanvas=this.canvases.length-1;this.canvases.forEach(function(entry,i){if(i==lastCanvas){canvasWidth=_this2.width-_this2.maxCanvasWidth*lastCanvas}_this2.updateDimensions(entry,canvasWidth,_this2.height);entry.clearWave()})}},{key:"addCanvas",value:function addCanvas(){var entry=new this.EntryClass;entry.canvasContextAttributes=this.canvasContextAttributes;entry.hasProgressCanvas=this.hasProgressCanvas;entry.halfPixel=this.halfPixel;var leftOffset=this.maxCanvasElementWidth*this.canvases.length;entry.initWave(this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:leftOffset+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"})));if(this.hasProgressCanvas){entry.initProgress(this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:leftOffset+"px",top:0,bottom:0,height:"100%"})))}this.canvases.push(entry)}},{key:"removeCanvas",value:function removeCanvas(){var lastEntry=this.canvases[this.canvases.length-1];lastEntry.wave.parentElement.removeChild(lastEntry.wave);if(this.hasProgressCanvas){lastEntry.progress.parentElement.removeChild(lastEntry.progress)}if(lastEntry){lastEntry.destroy();lastEntry=null}this.canvases.pop()}},{key:"updateDimensions",value:function updateDimensions(entry,width,height){var elementWidth=Math.round(width/this.params.pixelRatio);var totalWidth=Math.round(this.width/this.params.pixelRatio);entry.updateDimensions(elementWidth,totalWidth,width,height);this.style(this.progressWave,{display:"block"})}},{key:"clearWave",value:function clearWave(){var _this3=this;util.frame(function(){_this3.canvases.forEach(function(entry){return entry.clearWave()})})()}},{key:"drawBars",value:function drawBars(peaks,channelIndex,start,end){var _this4=this;return this.prepareDraw(peaks,channelIndex,start,end,function(_ref){var absmax=_ref.absmax,hasMinVals=_ref.hasMinVals,height=_ref.height,offsetY=_ref.offsetY,halfH=_ref.halfH,peaks=_ref.peaks;if(start===undefined){return}var peakIndexScale=hasMinVals?2:1;var length=peaks.length/peakIndexScale;var bar=_this4.params.barWidth*_this4.params.pixelRatio;var gap=_this4.params.barGap===null?Math.max(_this4.params.pixelRatio,~~(bar/2)):Math.max(_this4.params.pixelRatio,_this4.params.barGap*_this4.params.pixelRatio);var step=bar+gap;var scale=length/_this4.width;var first=start;var last=end;var i=first;for(i;i<last;i+=step){var peak=peaks[Math.floor(i*scale*peakIndexScale)]||0;var h=Math.round(peak/absmax*halfH);if(h==0&&_this4.params.barMinHeight)h=_this4.params.barMinHeight;_this4.fillRect(i+_this4.halfPixel,halfH-h+offsetY,bar+_this4.halfPixel,h*2,_this4.barRadius)}})}},{key:"drawWave",value:function drawWave(peaks,channelIndex,start,end){var _this5=this;return this.prepareDraw(peaks,channelIndex,start,end,function(_ref2){var absmax=_ref2.absmax,hasMinVals=_ref2.hasMinVals,height=_ref2.height,offsetY=_ref2.offsetY,halfH=_ref2.halfH,peaks=_ref2.peaks;if(!hasMinVals){var reflectedPeaks=[];var len=peaks.length;var i=0;for(i;i<len;i++){reflectedPeaks[2*i]=peaks[i];reflectedPeaks[2*i+1]=-peaks[i]}peaks=reflectedPeaks}if(start!==undefined){_this5.drawLine(peaks,absmax,halfH,offsetY,start,end)}_this5.fillRect(0,halfH+offsetY-_this5.halfPixel,_this5.width,_this5.halfPixel,_this5.barRadius)})}},{key:"drawLine",value:function drawLine(peaks,absmax,halfH,offsetY,start,end){var _this6=this;this.canvases.forEach(function(entry){_this6.setFillStyles(entry);entry.drawLines(peaks,absmax,halfH,offsetY,start,end)})}},{key:"fillRect",value:function fillRect(x,y,width,height,radius){var startCanvas=Math.floor(x/this.maxCanvasWidth);var endCanvas=Math.min(Math.ceil((x+width)/this.maxCanvasWidth)+1,this.canvases.length);var i=startCanvas;for(i;i<endCanvas;i++){var entry=this.canvases[i];var leftOffset=i*this.maxCanvasWidth;var intersection={x1:Math.max(x,i*this.maxCanvasWidth),y1:y,x2:Math.min(x+width,i*this.maxCanvasWidth+entry.wave.width),y2:y+height};if(intersection.x1<intersection.x2){this.setFillStyles(entry);entry.fillRects(intersection.x1-leftOffset,intersection.y1,intersection.x2-intersection.x1,intersection.y2-intersection.y1,radius)}}}},{key:"prepareDraw",value:function prepareDraw(peaks,channelIndex,start,end,fn){var _this7=this;return util.frame(function(){if(peaks[0]instanceof Array){var channels=peaks;if(_this7.params.splitChannels){_this7.setHeight(channels.length*_this7.params.height*_this7.params.pixelRatio);return channels.forEach(function(channelPeaks,i){return _this7.prepareDraw(channelPeaks,i,start,end,fn)})}peaks=channels[0]}var absmax=1/_this7.params.barHeight;if(_this7.params.normalize){var max=util.max(peaks);var min=util.min(peaks);absmax=-min>max?-min:max}var hasMinVals=[].some.call(peaks,function(val){return val<0});var height=_this7.params.height*_this7.params.pixelRatio;var offsetY=height*channelIndex||0;var halfH=height/2;return fn({absmax:absmax,hasMinVals:hasMinVals,height:height,offsetY:offsetY,halfH:halfH,peaks:peaks})})()}},{key:"setFillStyles",value:function setFillStyles(entry){entry.setFillStyles(this.params.waveColor,this.params.progressColor)}},{key:"getImage",value:function getImage(format,quality,type){if(type==="blob"){return Promise.all(this.canvases.map(function(entry){return entry.getImage(format,quality,type)}))}else if(type==="dataURL"){var images=this.canvases.map(function(entry){return entry.getImage(format,quality,type)});return images.length>1?images:images[0]}}},{key:"updateProgress",value:function updateProgress(position){this.style(this.progressWave,{width:position+"px"})}}]);return MultiCanvas}(_drawer.default);exports.default=MultiCanvas;module.exports=exports.default},"./src/mediaelement-webaudio.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _mediaelement=_interopRequireDefault(__webpack_require__("./src/mediaelement.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var MediaElementWebAudio=function(_MediaElement){_inherits(MediaElementWebAudio,_MediaElement);function MediaElementWebAudio(params){var _this;_classCallCheck(this,MediaElementWebAudio);_this=_possibleConstructorReturn(this,_getPrototypeOf(MediaElementWebAudio).call(this,params));_this.params=params;_this.sourceMediaElement=null;return _this}_createClass(MediaElementWebAudio,[{key:"init",value:function init(){this.setPlaybackRate(this.params.audioRate);this.createTimer();this.createVolumeNode();this.createScriptNode();this.createAnalyserNode()}},{key:"_load",value:function _load(media,peaks){_get(_getPrototypeOf(MediaElementWebAudio.prototype),"_load",this).call(this,media,peaks);this.createMediaElementSource(media)}},{key:"createMediaElementSource",value:function createMediaElementSource(mediaElement){this.sourceMediaElement=this.ac.createMediaElementSource(mediaElement);this.sourceMediaElement.connect(this.analyser)}}]);return MediaElementWebAudio}(_mediaelement.default);exports.default=MediaElementWebAudio;module.exports=exports.default},"./src/mediaelement.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _webaudio=_interopRequireDefault(__webpack_require__("./src/webaudio.js"));var util=_interopRequireWildcard(__webpack_require__("./src/util/index.js"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var MediaElement=function(_WebAudio){_inherits(MediaElement,_WebAudio);function MediaElement(params){var _this;_classCallCheck(this,MediaElement);_this=_possibleConstructorReturn(this,_getPrototypeOf(MediaElement).call(this,params));_this.params=params;_this.media={currentTime:0,duration:0,paused:true,playbackRate:1,play:function play(){},pause:function pause(){},volume:0};_this.mediaType=params.mediaType.toLowerCase();_this.elementPosition=params.elementPosition;_this.peaks=null;_this.playbackRate=1;_this.volume=1;_this.isMuted=false;_this.buffer=null;_this.onPlayEnd=null;_this.mediaListeners={};return _this}_createClass(MediaElement,[{key:"init",value:function init(){this.setPlaybackRate(this.params.audioRate);this.createTimer()}},{key:"_setupMediaListeners",value:function _setupMediaListeners(){var _this2=this;this.mediaListeners.error=function(){_this2.fireEvent("error","Error loading media element")};this.mediaListeners.canplay=function(){_this2.fireEvent("canplay")};this.mediaListeners.ended=function(){_this2.fireEvent("finish")};this.mediaListeners.play=function(){_this2.fireEvent("play")};this.mediaListeners.pause=function(){_this2.fireEvent("pause")};this.mediaListeners.seeked=function(event){_this2.fireEvent("seek")};this.mediaListeners.volumechange=function(event){_this2.isMuted=_this2.media.muted;if(_this2.isMuted){_this2.volume=0}else{_this2.volume=_this2.media.volume}_this2.fireEvent("volume")};Object.keys(this.mediaListeners).forEach(function(id){_this2.media.removeEventListener(id,_this2.mediaListeners[id]);_this2.media.addEventListener(id,_this2.mediaListeners[id])})}},{key:"createTimer",value:function createTimer(){var _this3=this;var onAudioProcess=function onAudioProcess(){if(_this3.isPaused()){return}_this3.fireEvent("audioprocess",_this3.getCurrentTime());util.frame(onAudioProcess)()};this.on("play",onAudioProcess);this.on("pause",function(){_this3.fireEvent("audioprocess",_this3.getCurrentTime())})}},{key:"load",value:function load(url,container,peaks,preload){var media=document.createElement(this.mediaType);media.controls=this.params.mediaControls;media.autoplay=this.params.autoplay||false;media.preload=preload==null?"auto":preload;media.src=url;media.style.width="100%";var prevMedia=container.querySelector(this.mediaType);if(prevMedia){container.removeChild(prevMedia)}container.appendChild(media);this._load(media,peaks)}},{key:"loadElt",value:function loadElt(elt,peaks){elt.controls=this.params.mediaControls;elt.autoplay=this.params.autoplay||false;this._load(elt,peaks)}},{key:"_load",value:function _load(media,peaks){if(!(media instanceof HTMLMediaElement)||typeof media.addEventListener==="undefined"){throw new Error("media parameter is not a valid media element")}if(typeof media.load=="function"){media.load()}this.media=media;this._setupMediaListeners();this.peaks=peaks;this.onPlayEnd=null;this.buffer=null;this.isMuted=media.muted;this.setPlaybackRate(this.playbackRate);this.setVolume(this.volume)}},{key:"isPaused",value:function isPaused(){return!this.media||this.media.paused}},{key:"getDuration",value:function getDuration(){if(this.explicitDuration){return this.explicitDuration}var duration=(this.buffer||this.media).duration;if(duration>=Infinity){duration=this.media.seekable.end(0)}return duration}},{key:"getCurrentTime",value:function getCurrentTime(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function getPlayedPercents(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function setPlaybackRate(value){this.playbackRate=value||1;this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function seekTo(start){if(start!=null){this.media.currentTime=start}this.clearPlayEnd()}},{key:"play",value:function play(start,end){this.seekTo(start);var promise=this.media.play();end&&this.setPlayEnd(end);return promise}},{key:"pause",value:function pause(){var promise;if(this.media){promise=this.media.pause()}this.clearPlayEnd();return promise}},{key:"setPlayEnd",value:function setPlayEnd(end){var _this4=this;this.clearPlayEnd();this._onPlayEnd=function(time){if(time>=end){_this4.pause();_this4.seekTo(end)}};this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function clearPlayEnd(){if(this._onPlayEnd){this.un("audioprocess",this._onPlayEnd);this._onPlayEnd=null}}},{key:"getPeaks",value:function getPeaks(length,first,last){if(this.buffer){return _get(_getPrototypeOf(MediaElement.prototype),"getPeaks",this).call(this,length,first,last)}return this.peaks||[]}},{key:"setSinkId",value:function setSinkId(deviceId){if(deviceId){if(!this.media.setSinkId){return Promise.reject(new Error("setSinkId is not supported in your browser"))}return this.media.setSinkId(deviceId)}return Promise.reject(new Error("Invalid deviceId: "+deviceId))}},{key:"getVolume",value:function getVolume(){return this.volume}},{key:"setVolume",value:function setVolume(value){this.volume=value;if(this.media.volume!==this.volume){this.media.volume=this.volume}}},{key:"destroy",value:function destroy(){var _this5=this;this.pause();this.unAll();this.destroyed=true;Object.keys(this.mediaListeners).forEach(function(id){if(_this5.media){_this5.media.removeEventListener(id,_this5.mediaListeners[id])}});if(this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode){this.media.parentNode.removeChild(this.media)}this.media=null}}]);return MediaElement}(_webaudio.default);exports.default=MediaElement;module.exports=exports.default},"./src/peakcache.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var PeakCache=function(){function PeakCache(){_classCallCheck(this,PeakCache);this.clearPeakCache()}_createClass(PeakCache,[{key:"clearPeakCache",value:function clearPeakCache(){this.peakCacheRanges=[];this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function addRangeToPeakCache(length,start,end){if(length!=this.peakCacheLength){this.clearPeakCache();this.peakCacheLength=length}var uncachedRanges=[];var i=0;while(i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<start){i++}if(i%2==0){uncachedRanges.push(start)}while(i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<=end){uncachedRanges.push(this.peakCacheRanges[i]);i++}if(i%2==0){uncachedRanges.push(end)}uncachedRanges=uncachedRanges.filter(function(item,pos,arr){if(pos==0){return item!=arr[pos+1]}else if(pos==arr.length-1){return item!=arr[pos-1]}return item!=arr[pos-1]&&item!=arr[pos+1]});this.peakCacheRanges=this.peakCacheRanges.concat(uncachedRanges);this.peakCacheRanges=this.peakCacheRanges.sort(function(a,b){return a-b}).filter(function(item,pos,arr){if(pos==0){return item!=arr[pos+1]}else if(pos==arr.length-1){return item!=arr[pos-1]}return item!=arr[pos-1]&&item!=arr[pos+1]});var uncachedRangePairs=[];for(i=0;i<uncachedRanges.length;i+=2){uncachedRangePairs.push([uncachedRanges[i],uncachedRanges[i+1]])}return uncachedRangePairs}},{key:"getCacheRanges",value:function getCacheRanges(){var peakCacheRangePairs=[];var i;for(i=0;i<this.peakCacheRanges.length;i+=2){peakCacheRangePairs.push([this.peakCacheRanges[i],this.peakCacheRanges[i+1]])}return peakCacheRangePairs}}]);return PeakCache}();exports.default=PeakCache;module.exports=exports.default},"./src/util/ajax.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=ajax;var _observer=_interopRequireDefault(__webpack_require__("./src/util/observer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ajax(options){var instance=new _observer.default;var xhr=new XMLHttpRequest;var fired100=false;xhr.open(options.method||"GET",options.url,true);xhr.responseType=options.responseType||"json";if(options.xhr){if(options.xhr.requestHeaders){options.xhr.requestHeaders.forEach(function(header){xhr.setRequestHeader(header.key,header.value)})}if(options.xhr.withCredentials){xhr.withCredentials=true}}xhr.addEventListener("progress",function(e){instance.fireEvent("progress",e);if(e.lengthComputable&&e.loaded==e.total){fired100=true}});xhr.addEventListener("load",function(e){if(!fired100){instance.fireEvent("progress",e)}instance.fireEvent("load",e);if(200==xhr.status||206==xhr.status){instance.fireEvent("success",xhr.response,e)}else{instance.fireEvent("error",e)}});xhr.addEventListener("error",function(e){return instance.fireEvent("error",e)});xhr.send();instance.xhr=xhr;return instance}module.exports=exports.default},"./src/util/extend.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=extend;function extend(dest){console.warn("util.extend is deprecated; use Object.assign instead");for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){sources[_key-1]=arguments[_key]}sources.forEach(function(source){Object.keys(source).forEach(function(key){dest[key]=source[key]})});return dest}module.exports=exports.default},"./src/util/fetch.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=fetchFile;var _observer=_interopRequireDefault(__webpack_require__("./src/util/observer.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var ProgressHandler=function(){function ProgressHandler(instance,contentLength,response){_classCallCheck(this,ProgressHandler);this.instance=instance;this.instance._reader=response.body.getReader();this.total=parseInt(contentLength,10);this.loaded=0}_createClass(ProgressHandler,[{key:"start",value:function start(controller){var _this=this;var read=function read(){_this.instance._reader.read().then(function(_ref){var done=_ref.done,value=_ref.value;if(done){if(_this.total===0){_this.instance.onProgress.call(_this.instance,{loaded:_this.loaded,total:_this.total,lengthComputable:false})}controller.close();return}_this.loaded+=value.byteLength;_this.instance.onProgress.call(_this.instance,{loaded:_this.loaded,total:_this.total,lengthComputable:!(_this.total===0)});controller.enqueue(value);read()}).catch(function(error){controller.error(error)})};read()}}]);return ProgressHandler}();function fetchFile(options){if(!options){throw new Error("fetch options missing")}else if(!options.url){throw new Error("fetch url missing")}var instance=new _observer.default;var fetchHeaders=new Headers;var fetchRequest=new Request(options.url);instance.controller=new AbortController;if(options&&options.requestHeaders){options.requestHeaders.forEach(function(header){fetchHeaders.append(header.key,header.value)})}var responseType=options.responseType||"json";var fetchOptions={method:options.method||"GET",headers:fetchHeaders,mode:options.mode||"cors",credentials:options.credentials||"same-origin",cache:options.cache||"default",redirect:options.redirect||"follow",referrer:options.referrer||"client",signal:instance.controller.signal};fetch(fetchRequest,fetchOptions).then(function(response){instance.response=response;var progressAvailable=true;if(!response.body){progressAvailable=false}var contentLength=response.headers.get("content-length");if(contentLength===null){progressAvailable=false}if(!progressAvailable){return response}instance.onProgress=function(e){instance.fireEvent("progress",e)};return new Response(new ReadableStream(new ProgressHandler(instance,contentLength,response)),fetchOptions)}).then(function(response){var errMsg;if(response.ok){switch(responseType){case"arraybuffer":return response.arrayBuffer();case"json":return response.json();case"blob":return response.blob();case"text":return response.text();default:errMsg="Unknown responseType: "+responseType;break}}if(!errMsg){errMsg="HTTP error status: "+response.status}throw new Error(errMsg)}).then(function(response){instance.fireEvent("success",response)}).catch(function(error){instance.fireEvent("error",error)});instance.fetchRequest=fetchRequest;return instance}module.exports=exports.default},"./src/util/frame.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=frame;var _requestAnimationFrame=_interopRequireDefault(__webpack_require__("./src/util/request-animation-frame.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function frame(func){return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return(0,_requestAnimationFrame.default)(function(){return func.apply(void 0,args)})}}module.exports=exports.default},"./src/util/get-id.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getId;function getId(prefix){if(prefix===undefined){prefix="wavesurfer_"}return prefix+Math.random().toString(32).substring(2)}module.exports=exports.default},"./src/util/index.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"ajax",{enumerable:true,get:function get(){return _ajax.default}});Object.defineProperty(exports,"getId",{enumerable:true,get:function get(){return _getId.default}});Object.defineProperty(exports,"max",{enumerable:true,get:function get(){return _max.default}});Object.defineProperty(exports,"min",{enumerable:true,get:function get(){return _min.default}});Object.defineProperty(exports,"Observer",{enumerable:true,get:function get(){return _observer.default}});Object.defineProperty(exports,"extend",{enumerable:true,get:function get(){return _extend.default}});Object.defineProperty(exports,"style",{enumerable:true,get:function get(){return _style.default}});Object.defineProperty(exports,"requestAnimationFrame",{enumerable:true,get:function get(){return _requestAnimationFrame.default}});Object.defineProperty(exports,"frame",{enumerable:true,get:function get(){return _frame.default}});Object.defineProperty(exports,"debounce",{enumerable:true,get:function get(){return _debounce.default}});Object.defineProperty(exports,"preventClick",{enumerable:true,get:function get(){return _preventClick.default}});Object.defineProperty(exports,"fetchFile",{enumerable:true,get:function get(){return _fetch.default}});var _ajax=_interopRequireDefault(__webpack_require__("./src/util/ajax.js"));var _getId=_interopRequireDefault(__webpack_require__("./src/util/get-id.js"));var _max=_interopRequireDefault(__webpack_require__("./src/util/max.js"));var _min=_interopRequireDefault(__webpack_require__("./src/util/min.js"));var _observer=_interopRequireDefault(__webpack_require__("./src/util/observer.js"));var _extend=_interopRequireDefault(__webpack_require__("./src/util/extend.js"));var _style=_interopRequireDefault(__webpack_require__("./src/util/style.js"));var _requestAnimationFrame=_interopRequireDefault(__webpack_require__("./src/util/request-animation-frame.js"));var _frame=_interopRequireDefault(__webpack_require__("./src/util/frame.js"));var _debounce=_interopRequireDefault(__webpack_require__("./node_modules/debounce/index.js"));var _preventClick=_interopRequireDefault(__webpack_require__("./src/util/prevent-click.js"));var _fetch=_interopRequireDefault(__webpack_require__("./src/util/fetch.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},"./src/util/max.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=max;function max(values){var largest=-Infinity;Object.keys(values).forEach(function(i){if(values[i]>largest){largest=values[i]}});return largest}module.exports=exports.default},"./src/util/min.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=min;function min(values){var smallest=Number(Infinity);Object.keys(values).forEach(function(i){if(values[i]<smallest){smallest=values[i]}});return smallest}module.exports=exports.default},"./src/util/observer.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Observer=function(){function Observer(){_classCallCheck(this,Observer);this.handlers=null}_createClass(Observer,[{key:"on",value:function on(event,fn){var _this=this;if(!this.handlers){this.handlers={}}var handlers=this.handlers[event];if(!handlers){handlers=this.handlers[event]=[]}handlers.push(fn);return{name:event,callback:fn,un:function un(e,fn){return _this.un(e,fn)}}}},{key:"un",value:function un(event,fn){if(!this.handlers){return}var handlers=this.handlers[event];var i;if(handlers){if(fn){for(i=handlers.length-1;i>=0;i--){if(handlers[i]==fn){handlers.splice(i,1)}}}else{handlers.length=0}}}},{key:"unAll",value:function unAll(){this.handlers=null}},{key:"once",value:function once(event,handler){var _this2=this;var fn=function fn(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}handler.apply(_this2,args);setTimeout(function(){_this2.un(event,fn)},0)};return this.on(event,fn)}},{key:"fireEvent",value:function fireEvent(event){for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}if(!this.handlers){return}var handlers=this.handlers[event];handlers&&handlers.forEach(function(fn){fn.apply(void 0,args)})}}]);return Observer}();exports.default=Observer;module.exports=exports.default},"./src/util/prevent-click.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=preventClick;function preventClickHandler(event){event.stopPropagation();document.body.removeEventListener("click",preventClickHandler,true)}function preventClick(values){document.body.addEventListener("click",preventClickHandler,true)}module.exports=exports.default},"./src/util/request-animation-frame.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _default=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){return setTimeout(callback,1e3/60)}).bind(window);exports.default=_default;module.exports=exports.default},"./src/util/style.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=style;function style(el,styles){Object.keys(styles).forEach(function(prop){if(el.style[prop]!==styles[prop]){el.style[prop]=styles[prop]}});return el}module.exports=exports.default},"./src/wavesurfer.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var util=_interopRequireWildcard(__webpack_require__("./src/util/index.js"));var _drawer=_interopRequireDefault(__webpack_require__("./src/drawer.multicanvas.js"));var _webaudio=_interopRequireDefault(__webpack_require__("./src/webaudio.js"));var _mediaelement=_interopRequireDefault(__webpack_require__("./src/mediaelement.js"));var _peakcache=_interopRequireDefault(__webpack_require__("./src/peakcache.js"));var _mediaelementWebaudio=_interopRequireDefault(__webpack_require__("./src/mediaelement-webaudio.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var PluginClass=function(){_createClass(PluginClass,[{key:"create",value:function create(params){}}]);function PluginClass(params,ws){_classCallCheck(this,PluginClass)}_createClass(PluginClass,[{key:"init",value:function init(){}},{key:"destroy",value:function destroy(){}}]);return PluginClass}();var WaveSurfer=function(_util$Observer){_inherits(WaveSurfer,_util$Observer);_createClass(WaveSurfer,null,[{key:"create",value:function create(params){var wavesurfer=new WaveSurfer(params);return wavesurfer.init()}}]);function WaveSurfer(params){var _this;_classCallCheck(this,WaveSurfer);_this=_possibleConstructorReturn(this,_getPrototypeOf(WaveSurfer).call(this));_this.defaultParams={audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:true,autoCenterRate:5,autoCenterImmediately:false,backend:"WebAudio",backgroundColor:null,barHeight:1,barRadius:0,barGap:null,barMinHeight:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:true,drawingContextAttributes:{desynchronized:false},duration:null,fillParent:true,forceDecode:false,height:128,hideScrollbar:false,interact:true,loopSelection:true,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:false,mediaType:"audio",minPxPerSec:20,normalize:false,partialRender:false,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:true,renderer:_drawer.default,responsive:false,rtl:false,scrollParent:false,skipLength:2,splitChannels:false,waveColor:"#999",xhr:{}};_this.backends={MediaElement:_mediaelement.default,WebAudio:_webaudio.default,MediaElementWebAudio:_mediaelementWebaudio.default};_this.util=util;_this.params=Object.assign({},_this.defaultParams,params);_this.container="string"==typeof params.container?document.querySelector(_this.params.container):_this.params.container;if(!_this.container){throw new Error("Container element not found")}if(_this.params.mediaContainer==null){_this.mediaContainer=_this.container}else if(typeof _this.params.mediaContainer=="string"){_this.mediaContainer=document.querySelector(_this.params.mediaContainer)}else{_this.mediaContainer=_this.params.mediaContainer}if(!_this.mediaContainer){throw new Error("Media Container element not found")}if(_this.params.maxCanvasWidth<=1){throw new Error("maxCanvasWidth must be greater than 1")}else if(_this.params.maxCanvasWidth%2==1){throw new Error("maxCanvasWidth must be an even number")}if(_this.params.rtl===true){util.style(_this.container,{transform:"rotateY(180deg)"})}if(_this.params.backgroundColor){_this.setBackgroundColor(_this.params.backgroundColor)}_this.savedVolume=0;_this.isMuted=false;_this.tmpEvents=[];_this.currentRequest=null;_this.arraybuffer=null;_this.drawer=null;_this.backend=null;_this.peakCache=null;if(typeof _this.params.renderer!=="function"){throw new Error("Renderer parameter is invalid")}_this.Drawer=_this.params.renderer;if(_this.params.backend=="AudioElement"){_this.params.backend="MediaElement"}if((_this.params.backend=="WebAudio"||_this.params.backend==="MediaElementWebAudio")&&!_webaudio.default.prototype.supportsWebAudio.call(null)){_this.params.backend="MediaElement"}_this.Backend=_this.backends[_this.params.backend];_this.initialisedPluginList={};_this.isDestroyed=false;_this.isReady=false;var prevWidth=0;_this._onResize=util.debounce(function(){if(prevWidth!=_this.drawer.wrapper.clientWidth&&!_this.params.scrollParent){prevWidth=_this.drawer.wrapper.clientWidth;_this.drawer.fireEvent("redraw")}},typeof _this.params.responsive==="number"?_this.params.responsive:100);return _possibleConstructorReturn(_this,_assertThisInitialized(_this))}_createClass(WaveSurfer,[{key:"init",value:function init(){this.registerPlugins(this.params.plugins);this.createDrawer();this.createBackend();this.createPeakCache();return this}},{key:"registerPlugins",value:function registerPlugins(plugins){var _this2=this;plugins.forEach(function(plugin){return _this2.addPlugin(plugin)});plugins.forEach(function(plugin){if(!plugin.deferInit){_this2.initPlugin(plugin.name)}});this.fireEvent("plugins-registered",plugins);return this}},{key:"getActivePlugins",value:function getActivePlugins(){return this.initialisedPluginList}},{key:"addPlugin",value:function addPlugin(plugin){var _this3=this;if(!plugin.name){throw new Error("Plugin does not have a name!")}if(!plugin.instance){throw new Error("Plugin ".concat(plugin.name," does not have an instance property!"))}if(plugin.staticProps){Object.keys(plugin.staticProps).forEach(function(pluginStaticProp){_this3[pluginStaticProp]=plugin.staticProps[pluginStaticProp]})}var Instance=plugin.instance;var observerPrototypeKeys=Object.getOwnPropertyNames(util.Observer.prototype);observerPrototypeKeys.forEach(function(key){Instance.prototype[key]=util.Observer.prototype[key]});this[plugin.name]=new Instance(plugin.params||{},this);this.fireEvent("plugin-added",plugin.name);return this}},{key:"initPlugin",value:function initPlugin(name){if(!this[name]){throw new Error("Plugin ".concat(name," has not been added yet!"))}if(this.initialisedPluginList[name]){this.destroyPlugin(name)}this[name].init();this.initialisedPluginList[name]=true;this.fireEvent("plugin-initialised",name);return this}},{key:"destroyPlugin",value:function destroyPlugin(name){if(!this[name]){throw new Error("Plugin ".concat(name," has not been added yet and cannot be destroyed!"))}if(!this.initialisedPluginList[name]){throw new Error("Plugin ".concat(name," is not active and cannot be destroyed!"))}if(typeof this[name].destroy!=="function"){throw new Error("Plugin ".concat(name," does not have a destroy function!"))}this[name].destroy();delete this.initialisedPluginList[name];this.fireEvent("plugin-destroyed",name);return this}},{key:"destroyAllPlugins",value:function destroyAllPlugins(){var _this4=this;Object.keys(this.initialisedPluginList).forEach(function(name){return _this4.destroyPlugin(name)})}},{key:"createDrawer",value:function createDrawer(){var _this5=this;this.drawer=new this.Drawer(this.container,this.params);this.drawer.init();this.fireEvent("drawer-created",this.drawer);if(this.params.responsive!==false){window.addEventListener("resize",this._onResize,true);window.addEventListener("orientationchange",this._onResize,true)}this.drawer.on("redraw",function(){_this5.drawBuffer();_this5.drawer.progress(_this5.backend.getPlayedPercents())});this.drawer.on("click",function(e,progress){setTimeout(function(){return _this5.seekTo(progress)},0)});this.drawer.on("scroll",function(e){if(_this5.params.partialRender){_this5.drawBuffer()}_this5.fireEvent("scroll",e)})}},{key:"createBackend",value:function createBackend(){var _this6=this;if(this.backend){this.backend.destroy()}this.backend=new this.Backend(this.params);this.backend.init();this.fireEvent("backend-created",this.backend);this.backend.on("finish",function(){_this6.drawer.progress(_this6.backend.getPlayedPercents());_this6.fireEvent("finish")});this.backend.on("play",function(){return _this6.fireEvent("play")});this.backend.on("pause",function(){return _this6.fireEvent("pause")});this.backend.on("audioprocess",function(time){_this6.drawer.progress(_this6.backend.getPlayedPercents());_this6.fireEvent("audioprocess",time)});if(this.params.backend==="MediaElement"||this.params.backend==="MediaElementWebAudio"){this.backend.on("seek",function(){_this6.drawer.progress(_this6.backend.getPlayedPercents())});this.backend.on("volume",function(){var newVolume=_this6.getVolume();_this6.fireEvent("volume",newVolume);if(_this6.backend.isMuted!==_this6.isMuted){_this6.isMuted=_this6.backend.isMuted;_this6.fireEvent("mute",_this6.isMuted)}})}}},{key:"createPeakCache",value:function createPeakCache(){if(this.params.partialRender){this.peakCache=new _peakcache.default}}},{key:"getDuration",value:function getDuration(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function getCurrentTime(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function setCurrentTime(seconds){if(seconds>=this.getDuration()){this.seekTo(1)}else{this.seekTo(seconds/this.getDuration())}}},{key:"play",value:function play(start,end){var _this7=this;this.fireEvent("interaction",function(){return _this7.play(start,end)});return this.backend.play(start,end)}},{key:"setPlayEnd",value:function setPlayEnd(position){this.backend.setPlayEnd(position)}},{key:"pause",value:function pause(){if(!this.backend.isPaused()){return this.backend.pause()}}},{key:"playPause",value:function playPause(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function isPlaying(){return!this.backend.isPaused()}},{key:"skipBackward",value:function skipBackward(seconds){this.skip(-seconds||-this.params.skipLength)}},{key:"skipForward",value:function skipForward(seconds){this.skip(seconds||this.params.skipLength)}},{key:"skip",value:function skip(offset){var duration=this.getDuration()||1;var position=this.getCurrentTime()||0;position=Math.max(0,Math.min(duration,position+(offset||0)));this.seekAndCenter(position/duration)}},{key:"seekAndCenter",value:function seekAndCenter(progress){this.seekTo(progress);this.drawer.recenter(progress)}},{key:"seekTo",value:function seekTo(progress){var _this8=this;if(typeof progress!=="number"||!isFinite(progress)||progress<0||progress>1){throw new Error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!")}this.fireEvent("interaction",function(){return _this8.seekTo(progress)});var paused=this.backend.isPaused();if(!paused){this.backend.pause()}var oldScrollParent=this.params.scrollParent;this.params.scrollParent=false;this.backend.seekTo(progress*this.getDuration());this.drawer.progress(progress);if(!paused){this.backend.play()}this.params.scrollParent=oldScrollParent;this.fireEvent("seek",progress)}},{key:"stop",value:function stop(){this.pause();this.seekTo(0);this.drawer.progress(0)}},{key:"setSinkId",value:function setSinkId(deviceId){return this.backend.setSinkId(deviceId)}},{key:"setVolume",value:function setVolume(newVolume){this.backend.setVolume(newVolume);this.fireEvent("volume",newVolume)}},{key:"getVolume",value:function getVolume(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function setPlaybackRate(rate){this.backend.setPlaybackRate(rate)}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function toggleMute(){this.setMute(!this.isMuted)}},{key:"setMute",value:function setMute(mute){if(mute===this.isMuted){this.fireEvent("mute",this.isMuted);return}if(mute){this.savedVolume=this.backend.getVolume();this.backend.setVolume(0);this.isMuted=true;this.fireEvent("volume",0)}else{this.backend.setVolume(this.savedVolume);this.isMuted=false;this.fireEvent("volume",this.savedVolume)}this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function getMute(){return this.isMuted}},{key:"getFilters",value:function getFilters(){return this.backend.filters||[]}},{key:"toggleScroll",value:function toggleScroll(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()}},{key:"toggleInteraction",value:function toggleInteraction(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function getWaveColor(){return this.params.waveColor}},{key:"setWaveColor",value:function setWaveColor(color){this.params.waveColor=color;this.drawBuffer()}},{key:"getProgressColor",value:function getProgressColor(){return this.params.progressColor}},{key:"setProgressColor",value:function setProgressColor(color){this.params.progressColor=color;this.drawBuffer()}},{key:"getBackgroundColor",value:function getBackgroundColor(){return this.params.backgroundColor}},{key:"setBackgroundColor",value:function setBackgroundColor(color){this.params.backgroundColor=color;util.style(this.container,{background:this.params.backgroundColor})}},{key:"getCursorColor",value:function getCursorColor(){return this.params.cursorColor}},{key:"setCursorColor",value:function setCursorColor(color){this.params.cursorColor=color;this.drawer.updateCursor()}},{key:"getHeight",value:function getHeight(){return this.params.height}},{key:"setHeight",value:function setHeight(height){this.params.height=height;this.drawer.setHeight(height*this.params.pixelRatio);this.drawBuffer()}},{key:"drawBuffer",value:function drawBuffer(){var nominalWidth=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);var parentWidth=this.drawer.getWidth();var width=nominalWidth;var start=0;var end=Math.max(start+parentWidth,width);if(this.params.fillParent&&(!this.params.scrollParent||nominalWidth<parentWidth)){width=parentWidth;start=0;end=width}var peaks;if(this.params.partialRender){var newRanges=this.peakCache.addRangeToPeakCache(width,start,end);var i;for(i=0;i<newRanges.length;i++){peaks=this.backend.getPeaks(width,newRanges[i][0],newRanges[i][1]);this.drawer.drawPeaks(peaks,width,newRanges[i][0],newRanges[i][1])}}else{peaks=this.backend.getPeaks(width,start,end);this.drawer.drawPeaks(peaks,width,start,end)}this.fireEvent("redraw",peaks,width)}},{key:"zoom",value:function zoom(pxPerSec){if(!pxPerSec){this.params.minPxPerSec=this.defaultParams.minPxPerSec;this.params.scrollParent=false}else{this.params.minPxPerSec=pxPerSec;this.params.scrollParent=true}this.drawBuffer();this.drawer.progress(this.backend.getPlayedPercents());this.drawer.recenter(this.getCurrentTime()/this.getDuration());this.fireEvent("zoom",pxPerSec)}},{key:"loadArrayBuffer",value:function loadArrayBuffer(arraybuffer){var _this9=this;this.decodeArrayBuffer(arraybuffer,function(data){if(!_this9.isDestroyed){_this9.loadDecodedBuffer(data)}})}},{key:"loadDecodedBuffer",value:function loadDecodedBuffer(buffer){this.backend.load(buffer);this.drawBuffer();this.isReady=true;this.fireEvent("ready")}},{key:"loadBlob",value:function loadBlob(blob){var _this10=this;var reader=new FileReader;reader.addEventListener("progress",function(e){return _this10.onProgress(e)});reader.addEventListener("load",function(e){return _this10.loadArrayBuffer(e.target.result)});reader.addEventListener("error",function(){return _this10.fireEvent("error","Error reading file")});reader.readAsArrayBuffer(blob);this.empty()}},{key:"load",value:function load(url,peaks,preload,duration){if(!url){throw new Error("url parameter cannot be empty")}this.empty();if(preload){var preloadIgnoreReasons={"Preload is not 'auto', 'none' or 'metadata'":["auto","metadata","none"].indexOf(preload)===-1,"Peaks are not provided":!peaks,"Backend is not of type 'MediaElement' or 'MediaElementWebAudio'":["MediaElement","MediaElementWebAudio"].indexOf(this.params.backend)===-1,"Url is not of type string":typeof url!=="string"};var activeReasons=Object.keys(preloadIgnoreReasons).filter(function(reason){return preloadIgnoreReasons[reason]});if(activeReasons.length){console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+activeReasons.join("\n\t- "));preload=null}}switch(this.params.backend){case"WebAudio":return this.loadBuffer(url,peaks,duration);case"MediaElement":case"MediaElementWebAudio":return this.loadMediaElement(url,peaks,preload,duration)}}},{key:"loadBuffer",value:function loadBuffer(url,peaks,duration){var _this11=this;var load=function load(action){if(action){_this11.tmpEvents.push(_this11.once("ready",action))}return _this11.getArrayBuffer(url,function(data){return _this11.loadArrayBuffer(data)})};if(peaks){this.backend.setPeaks(peaks,duration);this.drawBuffer();this.tmpEvents.push(this.once("interaction",load))}else{return load()}}},{key:"loadMediaElement",value:function loadMediaElement(urlOrElt,peaks,preload,duration){var _this12=this;var url=urlOrElt;if(typeof urlOrElt==="string"){this.backend.load(url,this.mediaContainer,peaks,preload)}else{var elt=urlOrElt;this.backend.loadElt(elt,peaks);url=elt.src}this.tmpEvents.push(this.backend.once("canplay",function(){if(!_this12.backend.destroyed){_this12.drawBuffer();_this12.isReady=true;_this12.fireEvent("ready")}}),this.backend.once("error",function(err){return _this12.fireEvent("error",err)}));if(peaks){this.backend.setPeaks(peaks,duration)}if((!peaks||this.params.forceDecode)&&this.backend.supportsWebAudio()){this.getArrayBuffer(url,function(arraybuffer){_this12.decodeArrayBuffer(arraybuffer,function(buffer){_this12.backend.buffer=buffer;_this12.backend.setPeaks(null);_this12.drawBuffer();_this12.fireEvent("waveform-ready")})})}}},{key:"decodeArrayBuffer",value:function decodeArrayBuffer(arraybuffer,callback){var _this13=this;this.arraybuffer=arraybuffer;this.backend.decodeArrayBuffer(arraybuffer,function(data){if(!_this13.isDestroyed&&_this13.arraybuffer==arraybuffer){callback(data);_this13.arraybuffer=null}},function(){return _this13.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function getArrayBuffer(url,callback){var _this14=this;var options=Object.assign({url:url,responseType:"arraybuffer"},this.params.xhr);var request=util.fetchFile(options);this.currentRequest=request;this.tmpEvents.push(request.on("progress",function(e){_this14.onProgress(e)}),request.on("success",function(data){callback(data);_this14.currentRequest=null}),request.on("error",function(e){_this14.fireEvent("error",e);_this14.currentRequest=null}));return request}},{key:"onProgress",value:function onProgress(e){var percentComplete;if(e.lengthComputable){percentComplete=e.loaded/e.total}else{percentComplete=e.loaded/(e.loaded+1e6)}this.fireEvent("loading",Math.round(percentComplete*100),e.target)}},{key:"exportPCM",value:function exportPCM(length,accuracy,noWindow,start,end){length=length||1024;start=start||0;accuracy=accuracy||1e4;noWindow=noWindow||false;var peaks=this.backend.getPeaks(length,start,end);var arr=[].map.call(peaks,function(val){return Math.round(val*accuracy)/accuracy});return new Promise(function(resolve,reject){var json=JSON.stringify(arr);if(!noWindow){window.open("data:application/json;charset=utf-8,"+encodeURIComponent(json))}resolve(json)})}},{key:"exportImage",value:function exportImage(format,quality,type){if(!format){format="image/png"}if(!quality){quality=1}if(!type){type="dataURL"}return this.drawer.getImage(format,quality,type)}},{key:"cancelAjax",value:function cancelAjax(){if(this.currentRequest&&this.currentRequest.controller){this.currentRequest.controller.abort();this.currentRequest=null}}},{key:"clearTmpEvents",value:function clearTmpEvents(){this.tmpEvents.forEach(function(e){return e.un()})}},{key:"empty",value:function empty(){if(!this.backend.isPaused()){this.stop();this.backend.disconnectSource()}this.isReady=false;this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function destroy(){this.destroyAllPlugins();this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();if(this.params.responsive!==false){window.removeEventListener("resize",this._onResize,true);window.removeEventListener("orientationchange",this._onResize,true)}if(this.backend){this.backend.destroy()}if(this.drawer){this.drawer.destroy()}this.isDestroyed=true;this.isReady=false;this.arraybuffer=null}}]);return WaveSurfer}(util.Observer);exports.default=WaveSurfer;WaveSurfer.VERSION="3.3.3";WaveSurfer.util=util;module.exports=exports.default},"./src/webaudio.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var util=_interopRequireWildcard(__webpack_require__("./src/util/index.js"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap;_getRequireWildcardCache=function _getRequireWildcardCache(){return cache};return cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var PLAYING="playing";var PAUSED="paused";var FINISHED="finished";var WebAudio=function(_util$Observer){_inherits(WebAudio,_util$Observer);_createClass(WebAudio,[{key:"supportsWebAudio",value:function supportsWebAudio(){return!!(window.AudioContext||window.webkitAudioContext)}},{key:"getAudioContext",value:function getAudioContext(){if(!window.WaveSurferAudioContext){window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)}return window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function getOfflineAudioContext(sampleRate){if(!window.WaveSurferOfflineAudioContext){window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,sampleRate)}return window.WaveSurferOfflineAudioContext}}]);function WebAudio(params){var _this$stateBehaviors,_this$states;var _this;_classCallCheck(this,WebAudio);_this=_possibleConstructorReturn(this,_getPrototypeOf(WebAudio).call(this));_this.audioContext=null;_this.offlineAudioContext=null;_this.stateBehaviors=(_this$stateBehaviors={},_defineProperty(_this$stateBehaviors,PLAYING,{init:function init(){this.addOnAudioProcess()},getPlayedPercents:function getPlayedPercents(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function getCurrentTime(){return this.startPosition+this.getPlayedTime()}}),_defineProperty(_this$stateBehaviors,PAUSED,{init:function init(){this.removeOnAudioProcess()},getPlayedPercents:function getPlayedPercents(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function getCurrentTime(){return this.startPosition}}),_defineProperty(_this$stateBehaviors,FINISHED,{init:function init(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function getPlayedPercents(){return 1},getCurrentTime:function getCurrentTime(){return this.getDuration()}}),_this$stateBehaviors);_this.params=params;_this.ac=params.audioContext||(_this.supportsWebAudio()?_this.getAudioContext():{});_this.lastPlay=_this.ac.currentTime;_this.startPosition=0;_this.scheduledPause=null;_this.states=(_this$states={},_defineProperty(_this$states,PLAYING,Object.create(_this.stateBehaviors[PLAYING])),_defineProperty(_this$states,PAUSED,Object.create(_this.stateBehaviors[PAUSED])),_defineProperty(_this$states,FINISHED,Object.create(_this.stateBehaviors[FINISHED])),_this$states);_this.buffer=null;_this.filters=[];_this.gainNode=null;_this.mergedPeaks=null;_this.offlineAc=null;_this.peaks=null;_this.playbackRate=1;_this.analyser=null;_this.scriptNode=null;_this.source=null;_this.splitPeaks=[];_this.state=null;_this.explicitDuration=params.duration;_this.destroyed=false;return _this}_createClass(WebAudio,[{key:"init",value:function init(){this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(PAUSED);this.setPlaybackRate(this.params.audioRate);this.setLength(0)}},{key:"disconnectFilters",value:function disconnectFilters(){if(this.filters){this.filters.forEach(function(filter){filter&&filter.disconnect()});this.filters=null;this.analyser.connect(this.gainNode)}}},{key:"setState",value:function setState(state){if(this.state!==this.states[state]){this.state=this.states[state];this.state.init.call(this)}}},{key:"setFilter",value:function setFilter(){for(var _len=arguments.length,filters=new Array(_len),_key=0;_key<_len;_key++){filters[_key]=arguments[_key]}this.setFilters(filters)}},{key:"setFilters",value:function setFilters(filters){this.disconnectFilters();if(filters&&filters.length){this.filters=filters;this.analyser.disconnect();filters.reduce(function(prev,curr){prev.connect(curr);return curr},this.analyser).connect(this.gainNode)}}},{key:"createScriptNode",value:function createScriptNode(){if(this.params.audioScriptProcessor){this.scriptNode=this.params.audioScriptProcessor}else{if(this.ac.createScriptProcessor){this.scriptNode=this.ac.createScriptProcessor(WebAudio.scriptBufferSize)}else{this.scriptNode=this.ac.createJavaScriptNode(WebAudio.scriptBufferSize)}}this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function addOnAudioProcess(){var _this2=this;this.scriptNode.onaudioprocess=function(){var time=_this2.getCurrentTime();if(time>=_this2.getDuration()){_this2.setState(FINISHED);_this2.fireEvent("pause")}else if(time>=_this2.scheduledPause){_this2.pause()}else if(_this2.state===_this2.states[PLAYING]){_this2.fireEvent("audioprocess",time)}}}},{key:"removeOnAudioProcess",value:function removeOnAudioProcess(){this.scriptNode.onaudioprocess=function(){}}},{key:"createAnalyserNode",value:function createAnalyserNode(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function createVolumeNode(){if(this.ac.createGain){this.gainNode=this.ac.createGain()}else{this.gainNode=this.ac.createGainNode()}this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function setSinkId(deviceId){if(deviceId){var audio=new window.Audio;if(!audio.setSinkId){return Promise.reject(new Error("setSinkId is not supported in your browser"))}audio.autoplay=true;var dest=this.ac.createMediaStreamDestination();this.gainNode.disconnect();this.gainNode.connect(dest);audio.srcObject=dest.stream;return audio.setSinkId(deviceId)}else{return Promise.reject(new Error("Invalid deviceId: "+deviceId))}}},{key:"setVolume",value:function setVolume(value){this.gainNode.gain.setValueAtTime(value,this.ac.currentTime)}},{key:"getVolume",value:function getVolume(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function decodeArrayBuffer(arraybuffer,callback,errback){if(!this.offlineAc){this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)}this.offlineAc.decodeAudioData(arraybuffer,function(data){return callback(data)},errback)}},{key:"setPeaks",value:function setPeaks(peaks,duration){if(duration!=null){this.explicitDuration=duration}this.peaks=peaks}},{key:"setLength",value:function setLength(length){if(this.mergedPeaks&&length==2*this.mergedPeaks.length-1+2){return}this.splitPeaks=[];this.mergedPeaks=[];var channels=this.buffer?this.buffer.numberOfChannels:1;var c;for(c=0;c<channels;c++){this.splitPeaks[c]=[];this.splitPeaks[c][2*(length-1)]=0;this.splitPeaks[c][2*(length-1)+1]=0}this.mergedPeaks[2*(length-1)]=0;this.mergedPeaks[2*(length-1)+1]=0}},{key:"getPeaks",value:function getPeaks(length,first,last){if(this.peaks){return this.peaks}if(!this.buffer){return[]}first=first||0;last=last||length-1;this.setLength(length);if(!this.buffer){return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}if(!this.buffer.length){var newBuffer=this.createBuffer(1,4096,this.sampleRate);this.buffer=newBuffer.buffer}var sampleSize=this.buffer.length/length;var sampleStep=~~(sampleSize/10)||1;var channels=this.buffer.numberOfChannels;var c;for(c=0;c<channels;c++){var peaks=this.splitPeaks[c];var chan=this.buffer.getChannelData(c);var i=void 0;for(i=first;i<=last;i++){var start=~~(i*sampleSize);var end=~~(start+sampleSize);var min=0;var max=0;var j=void 0;for(j=start;j<end;j+=sampleStep){var value=chan[j];if(value>max){max=value}if(value<min){min=value}}peaks[2*i]=max;peaks[2*i+1]=min;if(c==0||max>this.mergedPeaks[2*i]){this.mergedPeaks[2*i]=max}if(c==0||min<this.mergedPeaks[2*i+1]){this.mergedPeaks[2*i+1]=min}}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function getPlayedPercents(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function disconnectSource(){if(this.source){this.source.disconnect()}}},{key:"destroy",value:function destroy(){if(!this.isPaused()){this.pause()}this.unAll();this.buffer=null;this.destroyed=true;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();if(this.params.closeAudioContext){if(typeof this.ac.close==="function"&&this.ac.state!="closed"){this.ac.close()}this.ac=null;if(!this.params.audioContext){window.WaveSurferAudioContext=null}else{this.params.audioContext=null}window.WaveSurferOfflineAudioContext=null}}},{key:"load",value:function load(buffer){this.startPosition=0;this.lastPlay=this.ac.currentTime;this.buffer=buffer;this.createSource()}},{key:"createSource",value:function createSource(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime);this.source.buffer=this.buffer;this.source.connect(this.analyser)}},{key:"isPaused",value:function isPaused(){return this.state!==this.states[PLAYING]}},{key:"getDuration",value:function getDuration(){if(this.explicitDuration){return this.explicitDuration}if(!this.buffer){return 0}return this.buffer.duration}},{key:"seekTo",value:function seekTo(start,end){if(!this.buffer){return}this.scheduledPause=null;if(start==null){start=this.getCurrentTime();if(start>=this.getDuration()){start=0}}if(end==null){end=this.getDuration()}this.startPosition=start;this.lastPlay=this.ac.currentTime;if(this.state===this.states[FINISHED]){this.setState(PAUSED)}return{start:start,end:end}}},{key:"getPlayedTime",value:function getPlayedTime(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function play(start,end){if(!this.buffer){return}this.createSource();var adjustedTime=this.seekTo(start,end);start=adjustedTime.start;end=adjustedTime.end;this.scheduledPause=end;this.source.start(0,start);if(this.ac.state=="suspended"){this.ac.resume&&this.ac.resume()}this.setState(PLAYING);this.fireEvent("play")}},{key:"pause",value:function pause(){this.scheduledPause=null;this.startPosition+=this.getPlayedTime();this.source&&this.source.stop(0);this.setState(PAUSED);this.fireEvent("pause")}},{key:"getCurrentTime",value:function getCurrentTime(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this.playbackRate}},{key:"setPlaybackRate",value:function setPlaybackRate(value){value=value||1;if(this.isPaused()){this.playbackRate=value}else{this.pause();this.playbackRate=value;this.play()}}},{key:"setPlayEnd",value:function setPlayEnd(end){this.scheduledPause=end}}]);return WebAudio}(util.Observer);exports.default=WebAudio;WebAudio.scriptBufferSize=256;module.exports=exports.default}})});